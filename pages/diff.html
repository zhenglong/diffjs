<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<title>diff</title>
		<meta name="description" content="" />
		<meta name="author" content="tristan" />

		<meta name="viewport" content="width=device-width; initial-scale=1.0" />

		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
		<script type="text/javascript" src="../js/vendor/jquery-1.7.2.js"></script>
		<script type="text/javascript" src="../js/diff.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/diff.css" /> 
		<link rel="stylesheet" type="text/css" href="../css/main.css" />
		<script>
			$(function() {
				var util = window.util;
				var fileIO = util.fileIO;
				$("#btnDiff").click(function() {
					var files = $(".select-file > input[type=file]").get()[0].files;
					if (files.length != 2) {
						window.alert("You should choose 2 files to compare them!");
						return;
					}
					var msg = "", maxSize = 1024*1024*1024;
					if (files[0].size > maxSize) {
						msg = msg + files[0].name;
					}
					if (files[1].size > maxSize) {
						msg = msg + "\n" + files[1].name;
					}
					if (msg != "") {
						window.alert("The following file(s) larger than 1MB:" + msg);
						return;
					}
					var done = 0;
					var lines = [];
					fileIO.onPostRead = function() {
						var len = arguments.length;
						if (len == 2) {
							window.alert("Failed to open file: " + arguments[1].name);
							return;
						} else {
							lines.push(arguments[0].split(/[\r\n]+/));
							done++;
							if (done == 2) {
								var commons = util.Diff(lines[0], lines[1]);
								var result = util.GenerateComparison(lines[0], lines[1], commons);
								$(".file-content-wrapper.left").append(result[0]);
								$(".file-content-wrapper.right").append(result[1]);
							}
						}
					};
					$.each(files, function(index, file) {
						window.util.fileIO.Read(file);
					});
				});
			});
		</script>
	</head>
	<body>
		<div>
			<header>
				<h1>File Comparison and Merging</h1>
			</header>
			<div id="content">
				<div class="select-file">
					<label for="files">Please select two files to diff:</label>
					<input type="file" value="File" multiple required="true" id="files" />
					<input type="button" id="btnDiff" value="Diff" />
				</div>
				<div class="comparison-result">
					<div class="file-content-wrapper left"></div>
					<div id="tool"></div>
					<div class="file-content-wrapper right"></div>
				</div>
			</div>
			<footer>
				<p>
					&copy; Copyright  by tristan
				</p>
			</footer>
		</div>
	</body>
</html>
